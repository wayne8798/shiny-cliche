<!DOCTYPE html>
<html>
<header>
	
</header>
<body>
	<div>Test</div>
	<button onclick="stopVideo();">Stop</button>
	<button onclick="snapshot();">Snap</button>
	<video id="video1" autoplay></video>
	<div>
		<canvas id="canvas1" width="640" height="480" style="display:none" ></canvas>
	</div>
	
	<img id="img1">
	<script>
		var video = document.getElementById('video1');
	  	var canvas = document.getElementById('canvas1');
	  	var image = document.getElementById('img1');
	  	var ctx = canvas.getContext('2d');
	  	var localMediaStream = null;

	  	function snapshot(){
	  		if(localMediaStream)
	  		{
	  			ctx.drawImage(video,0,0,640,480);
	  			image.src= canvas.toDataURL('image/webp');
	  		}
	  	}

	  function stopVideo(){
	  	
	  	localMediaStream.stop();
	  }

	  var errorCallback = function(e) {
	    console.log('Reeeejected!', e);
	    alert("errorCallback");
	  };

	  var vgaConstraints = {
		  video: {
		    mandatory: {
		      maxWidth: 640,
		      maxHeight: 360
		    }
		  }
		};		
	  // Not showing vendor prefixes.
	  navigator.webkitGetUserMedia({video:true}, successCallback, errorCallback);

	  function successCallback(stream) {
	  	localMediaStream = stream;
	    var video = document.getElementById('video1');
	    video.src = window.URL.createObjectURL(localMediaStream);

	    // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.
	    // See crbug.com/110938.
	    video.onloadedmetadata = function(e) {
	      // Ready to go. Do some stuff.
	    };
	  }
	</script>
</body>
</html>